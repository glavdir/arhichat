webpackJsonp([1],{255:function(t,e,a){"use strict";function i(t){a(269),a(271)}Object.defineProperty(e,"__esModule",{value:!0});var s=a(260),r=a(277),n=a(5),l=i,c=n(s.a,r.a,!1,l,"data-v-0f90f752",null);e.default=c.exports},260:function(t,e,a){"use strict";function i(){return{id:null,name:"",description:"",author:null,author_name:"",tags:[]}}var s=(a(7),a(8),a(20)),r=(a.n(s),a(273));e.a={components:{"tags-input":r.a},data:function(){return{currentChar:"",charList:[],charFilter:"",tagsFilter:[],tagPattern:"[\\s0-9a-zA-Zа-яА-Я_]+",editData:i(),allTags:[]}},created:function(){this.$socket.emit("find_characters"),this.$socket.emit("get_tags")},computed:{filteredCharacters:function(){var t=this.remove_empty_elements(this.tagsFilter),e=this.charFilter.trim(),a=e.length>0,i=t.length>0;if(!a&&!i)return this.charList;var s=[];for(var r in this.charList){var n=this.charList[r];if(a&&n.name.toLowerCase().includes(e.toLowerCase()))s.includes(n)||s.push(n);else if(i){var l=!0;for(var c in t)if(!n.tags.includes(t[c])){l=!1;break}l&&!s.includes(n)&&s.push(n)}}return s}},methods:{remove_empty_elements:function(t){var e=[];for(var a in t)""!=t[a]&&e.push(t[a]);return e},find_characters:function(){var t={name:this.charFilter,tags:this.remove_empty_elements(this.tagsFilter)};this.$socket.emit("find_characters",t)},setCharacterList:function(t){var e=this.currentChar;if(this.charList=t,e)for(var a in this.charList)if(this.charList[a].id==e)return void this.selectCharacter()},selectCharacter:function(){if(this.currentChar&&0!=this.currentChar.length){var t=this;this.$socket.emit("get_character_info",{id:this.currentChar},function(e){t.setCharacterData(JSON.parse(e))})}else this.editData=i()},setCharacterData:function(t){this.editData=t},resetEditData:function(){this.editData=i(),this.currentChar=null},saveChanges:function(t){if(this.currentChar){var e=this.$refs.charSelect.options[this.$refs.charSelect.selectedIndex].text;if(!window.confirm('Вы точно хотите изменить персонажа "'+e+'"?'))return}if(0==this.editData.name.length||0==this.editData.description.length)return void alert('Заполните поля "Имя" и "Описание" для сохранения персонажа');this.editData.tags=this.remove_empty_elements(this.editData.tags);var a=this.editData.name,i=this;this.$socket.emit("save_character",{Character:this.editData},function(t){t?(alert('Персонаж "'+a+'" успешно сохранен'),i.find_characters(),i.setCharacterData(JSON.parse(t))):alert('Упс! Не получилось создать персонажа "'+a+'"')})},deleteCharacter:function(){if(!this.currentChar)return void alert("Такого персонажа не существует. Персонаж не выбран или кто-то его уже удалил пока вы тупили. Перезагрузите страницу");var t=this.$refs.charSelect.options[this.$refs.charSelect.selectedIndex].text;if(console.log(t),window.confirm('Вы точно хотите удалить персонажа "'+t+'"?')&&window.confirm("Если потом передумаете придётся восстанавливать вручную. Точно удалять?")){var e=this;this.$socket.emit("delete_character",{Character:this.currentChar},function(a){console.log(a),a?(alert('Персонаж "'+t+'" удалён'),e.resetEditData(),e.find_characters()):alert('Упс! Что-то пошло не так. Персонаж "'+t+'" не был удалён')})}}},sockets:{character_list:function(t){this.setCharacterList(JSON.parse(t))},character_tags:function(t){this.allTags=JSON.parse(t)}}}},261:function(t,e,a){"use strict";var i=a(170),s=a.n(i);e.a={model:{prop:"outTags",event:"input"},props:{outTags:Array,fullTagList:Array},components:{ClickOutside:s.a},data:function(){return{listVisible:!1,listFilter:"",focusedItem:null}},computed:{tagsFiltered:function(){if(0==this.inputText)return this.fullTagList;var t=[];for(var e in this.fullTagList)this.fullTagList[e].includes(this.listFilter)&&t.push(this.fullTagList[e]);return t},inputText:{get:function(){return this.outTags.join(" ")},set:function(t){var e=this.validateString(t).split(" ");this.$emit("input",e)}}},methods:{processArrowKeyDown:function(){if(!this.listVisible)return void this.setSelectorVisible(!0);this.focusedItem==this.$refs.search_input?this.focusedItem=this.$refs.list.firstElementChild:(this.focusedItem=this.focusedItem.nextElementSibling,this.focusedItem||(this.focusedItem=this.$refs.list.firstElementChild)),this.focusedItem&&this.focusedItem.focus()},processArrowKeyUp:function(){if(!this.listVisible)return void this.setSelectorVisible(!0);this.focusedItem==this.$refs.search_input?this.focusedItem=this.$refs.list.lastElementChild:(this.focusedItem=this.focusedItem.previousElementSibling,this.focusedItem||(this.focusedItem=this.$refs.list.lastElementChild)),this.focusedItem&&this.focusedItem.focus()},setSelectorVisible:function(t,e){var a=this;this.listVisible=t,t?this.$nextTick(function(){a.$refs.search_input.focus(),a.focusedItem=a.$refs.search_input}):(this.listFilter="",e&&this.$refs.tags_input.focus())},validateString:function(t){return t.toLowerCase().replace(/\s+/g," ").replace(/[^\s0-9a-zA-Zа-яА-Я_]+/,"")},addTagToOut:function(t){this.setSelectorVisible(!1,!0),this.outTags.includes(t)||this.outTags.push(t)},handleClickOutside:function(t){this.setSelectorVisible(!1)}}}},269:function(t,e,a){var i=a(270);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a(4)("3c6d9f82",i,!0)},270:function(t,e,a){e=t.exports=a(3)(!1),e.push([t.i,".characterEdit_root[data-v-0f90f752]{padding:.5em}input_field[data-v-0f90f752]{border:1px solid gray;padding:0 .1em}.flex_container[data-v-0f90f752]{display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;flex-wrap:wrap}.flex_element[data-v-0f90f752]{flex-grow:2}.full_width[data-v-0f90f752]{width:100%}.space_after[data-v-0f90f752]{padding-right:.5rem}.frame[data-v-0f90f752]{border:1px solid #d3d3d3;border-radius:3px}.thickLine[data-v-0f90f752]{margin:.3em 0}.v_center[data-v-0f90f752]{margin:auto}",""])},271:function(t,e,a){var i=a(272);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a(4)("01ca6fc9",i,!0)},272:function(t,e,a){e=t.exports=a(3)(!1),e.push([t.i,".characterEdit_root input[type=text]{padding:0 .1em}",""])},273:function(t,e,a){"use strict";function i(t){a(274)}var s=a(261),r=a(276),n=a(5),l=i,c=n(s.a,r.a,!1,l,"data-v-7a0b7f55",null);e.a=c.exports},274:function(t,e,a){var i=a(275);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a(4)("6338f311",i,!0)},275:function(t,e,a){e=t.exports=a(3)(!1),e.push([t.i,".tags[data-v-7a0b7f55]{position:relative;display:flex;flex-grow:2;border:1px solid #d3d3d3}.tags_input[data-v-7a0b7f55]{border:none;flex-grow:2}.tags_select_button[data-v-7a0b7f55]{cursor:pointer;border:none;border-left:1px solid #fafafa;background:#f8f8f8;flex-grow:0}.tags_select_button[data-v-7a0b7f55]:hover{background-color:#fff}.tags_list_frame[data-v-7a0b7f55]{position:absolute;overflow:auto;max-height:6rem;top:calc(100% + 2px);background:#fff;border-radius:0;right:0;z-index:100;padding:.2em;border:1px solid gray;box-shadow:3px 3px 5px 0 rgba(0,0,0,.2)}.tags_list_frame ul[data-v-7a0b7f55]{margin:.3em 0}.tags_list_frame li[data-v-7a0b7f55]{padding:0 .3em 0 .2em;cursor:pointer}.tags_list_frame li[data-v-7a0b7f55]:focus,.tags_list_frame li[data-v-7a0b7f55]:hover{background-color:#cfe7f0}.tags_select_search[data-v-7a0b7f55]{border:none;border-bottom:1px solid #d3d3d3}",""])},276:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("click-outside",{attrs:{handler:t.handleClickOutside}},[a("div",{staticClass:"tags",on:{keydown:[function(e){if(!("button"in e)&&t._k(e.keyCode,"esc",27,e.key))return null;t.setSelectorVisible(!1,!0)},function(e){if(!("button"in e)&&t._k(e.keyCode,"down",40,e.key))return null;t.processArrowKeyDown()},function(e){if(!("button"in e)&&t._k(e.keyCode,"up",38,e.key))return null;t.processArrowKeyUp()}]}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.inputText,expression:"inputText"}],ref:"tags_input",staticClass:"tags_input",attrs:{type:"text",placeholder:"Тэги через пробел"},domProps:{value:t.inputText},on:{input:function(e){e.target.composing||(t.inputText=e.target.value)}}}),t._v(" "),a("button",{staticClass:"tags_select_button",attrs:{title:"Добавить тэг из списка существующих.\nОткрывается нажатием ↓ из строки поиска"},on:{click:function(e){t.setSelectorVisible(!t.listVisible)}}},[t._v("+\n            ")]),t._v(" "),t.listVisible?a("div",{ref:"tag_list",staticClass:"tags_list_frame"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.listFilter,expression:"listFilter"}],ref:"search_input",staticClass:"tags_select_search",attrs:{type:"text",placeholder:" Поиск",tabindex:"0"},domProps:{value:t.listFilter},on:{input:function(e){e.target.composing||(t.listFilter=e.target.value)}}}),t._v(" "),a("ul",{ref:"list",attrs:{tabindex:"1"}},t._l(t.tagsFiltered,function(e,i){return a("li",{staticClass:"tags_select_li",attrs:{tabindex:i+1},on:{click:function(a){t.addTagToOut(e)},keydown:function(a){if(!("button"in a)&&t._k(a.keyCode,"enter",13,a.key))return null;t.addTagToOut(e)}}},[t._v("\n                        "+t._s(e)+"\n                    ")])}))]):t._e()])])},s=[],r={render:i,staticRenderFns:s};e.a=r},277:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"characterEdit_root"},[a("fieldset",{staticClass:"frame"},[a("legend",[t._v("Поиск")]),t._v(" "),a("div",{staticClass:"flex_container thickLine"},[a("span",{staticClass:"space_after v_center"},[t._v("Имя")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.charFilter,expression:"charFilter"}],staticClass:"flex_element input_field v_center",attrs:{type:"text",maxlength:"64",placeholder:"Имя или его начало"},domProps:{value:t.charFilter},on:{input:function(e){e.target.composing||(t.charFilter=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"flex_container thickLine"},[a("span",{staticClass:"space_after v_center"},[t._v("Тэги")]),t._v(" "),a("tags-input",{staticClass:"flex_element v_center",attrs:{fullTagList:t.allTags,maxlength:"64",placeholder:"Тэги через пробел"},model:{value:t.tagsFilter,callback:function(e){t.tagsFilter=e},expression:"tagsFilter"}})],1),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:t.currentChar,expression:"currentChar"}],ref:"charSelect",staticClass:"full_width thickLine",attrs:{size:"5"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.currentChar=e.target.multiple?a:a[0]},t.selectCharacter]}},t._l(t.filteredCharacters,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))]),t._v(" "),a("fieldset",{staticClass:"frame"},[a("legend",[t._v("Персонаж")]),t._v(" "),a("div",{staticClass:"flex_container thickLine"},[a("span",{staticClass:"space_after v_center"},[t._v("Имя")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.editData.name,expression:"editData.name"}],staticClass:"flex_element input_field",attrs:{type:"text",maxlength:"64",placeholder:"Мне нужно ИМЯ!"},domProps:{value:t.editData.name},on:{input:function(e){e.target.composing||t.$set(t.editData,"name",e.target.value)}}})]),t._v(" "),a("span",{staticClass:"thickLine v_center"},[t._v("Описание")]),a("br"),t._v(" "),a("div",{staticClass:"flex_container"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editData.description,expression:"editData.description"}],staticClass:"full_width thickLine",attrs:{rows:"4"},domProps:{value:t.editData.description},on:{input:function(e){e.target.composing||t.$set(t.editData,"description",e.target.value)}}})]),t._v(" "),a("div",{staticClass:"flex_container thickLine",attrs:{id:"character_tags_container"},on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"esc",27,e.key))return null;t.showTagSelector(!1)}}},[a("span",{staticClass:" space_after v_center"},[t._v("Тэги")]),t._v(" "),a("tags-input",{staticClass:"flex_element v_center",attrs:{fullTagList:t.allTags,maxlength:"64",placeholder:"Тэги через пробел"},model:{value:t.editData.tags,callback:function(e){t.$set(t.editData,"tags",e)},expression:"editData.tags"}})],1),t._v(" "),t.editData.author?a("div",{staticClass:"thickLine"},[a("span",[t._v("Автор:")]),t._v(" "),a("span",{staticClass:"display_frame "},[t._v(t._s(t.editData.author_name))])]):t._e(),t._v(" "),a("div",{staticClass:"flex_container thickLine"},[a("button",{attrs:{title:"Сбросить редактирование"},on:{click:t.resetEditData}},[t._v("Новый")]),t._v(" "),a("div",{staticClass:"flex_element"}),t._v(" "),a("button",{attrs:{id:"delete_button",title:"Отправить персонажа в варп",disabled:!t.currentChar},on:{click:t.deleteCharacter}},[t._v("Удалить\n            ")]),t._v(" "),a("button",{attrs:{id:"save_button",title:"Сохранить"},on:{click:t.saveChanges}},[t._v("Сохранить\n            ")])])])])},s=[],r={render:i,staticRenderFns:s};e.a=r}});
//# sourceMappingURL=1.build.js.map