webpackJsonp([0],{277:function(t,e,i){"use strict";function a(t){i(293),i(295)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(283),r=i(301),n=i(6),o=a,c=n(s.a,r.a,!1,o,"data-v-0f90f752",null);e.default=c.exports},282:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(292),s=i(321),r=i(6),n=r(a.a,s.a,!1,null,null,null);e.default=n.exports},283:function(t,e,i){"use strict";function a(){return{id:null,name:"",description:"",author:null,author_name:"",tags:[]}}var s=(i(8),i(9),i(21)),r=(i.n(s),i(297));e.a={components:{"tags-input":r.a},data:function(){return{currentChar:"",charList:[],charFilter:"",tagsFilter:[],tagPattern:"[\\s0-9a-zA-Zа-яА-Я_]+",editData:a(),allTags:[]}},created:function(){this.$socket.emit("find_characters"),this.$socket.emit("get_tags")},computed:{filteredCharacters:function(){var t=this.remove_empty_elements(this.tagsFilter),e=this.charFilter.trim(),i=e.length>0,a=t.length>0;if(!i&&!a)return this.charList;var s=[];for(var r in this.charList){var n=this.charList[r];if(i&&n.name.toLowerCase().includes(e.toLowerCase()))s.includes(n)||s.push(n);else if(a){var o=!0;for(var c in t)if(!n.tags.includes(t[c])){o=!1;break}o&&!s.includes(n)&&s.push(n)}}return s}},methods:{remove_empty_elements:function(t){var e=[];for(var i in t)""!=t[i]&&e.push(t[i]);return e},find_characters:function(){var t={name:this.charFilter,tags:this.remove_empty_elements(this.tagsFilter)};this.$socket.emit("find_characters",t)},setCharacterList:function(t){var e=this.currentChar;if(this.charList=t,e)for(var i in this.charList)if(this.charList[i].id==e)return void this.selectCharacter()},selectCharacter:function(){if(this.currentChar&&0!=this.currentChar.length){var t=this;this.$socket.emit("get_character_info",{id:this.currentChar},function(e){t.setCharacterData(JSON.parse(e))})}else this.editData=a()},setCharacterData:function(t){this.editData=t},resetEditData:function(){this.editData=a(),this.currentChar=null},saveChanges:function(t){if(this.currentChar){var e=this.$refs.charSelect.options[this.$refs.charSelect.selectedIndex].text;if(!window.confirm('Вы точно хотите изменить персонажа "'+e+'"?'))return}if(0==this.editData.name.length||0==this.editData.description.length)return void alert('Заполните поля "Имя" и "Описание" для сохранения персонажа');this.editData.tags=this.remove_empty_elements(this.editData.tags);var i=this.editData.name,a=this;this.$socket.emit("save_character",{Character:this.editData},function(t){t?(alert('Персонаж "'+i+'" успешно сохранен'),a.find_characters(),a.setCharacterData(JSON.parse(t))):alert('Упс! Не получилось создать персонажа "'+i+'"')})},deleteCharacter:function(){if(!this.currentChar)return void alert("Такого персонажа не существует. Персонаж не выбран или кто-то его уже удалил пока вы тупили. Перезагрузите страницу");var t=this.$refs.charSelect.options[this.$refs.charSelect.selectedIndex].text;if(console.log(t),window.confirm('Вы точно хотите удалить персонажа "'+t+'"?')&&window.confirm("Если потом передумаете придётся восстанавливать вручную. Точно удалять?")){var e=this;this.$socket.emit("delete_character",{Character:this.currentChar},function(i){console.log(i),i?(alert('Персонаж "'+t+'" удалён'),e.resetEditData(),e.find_characters()):alert('Упс! Что-то пошло не так. Персонаж "'+t+'" не был удалён')})}}},sockets:{character_list:function(t){this.setCharacterList(JSON.parse(t))},character_tags:function(t){this.allTags=JSON.parse(t)}}}},284:function(t,e,i){"use strict";var a=i(173),s=i.n(a);e.a={model:{prop:"outTags",event:"input"},props:{outTags:Array,fullTagList:Array},components:{ClickOutside:s.a},data:function(){return{listVisible:!1,listFilter:"",focusedItem:null}},computed:{tagsFiltered:function(){if(0==this.inputText)return this.fullTagList;var t=[];for(var e in this.fullTagList)this.fullTagList[e].includes(this.listFilter)&&t.push(this.fullTagList[e]);return t},inputText:{get:function(){return this.outTags.join(" ")},set:function(t){var e=this.validateString(t).split(" ");this.$emit("input",e)}}},methods:{processArrowKeyDown:function(){if(!this.listVisible)return void this.setSelectorVisible(!0);this.focusedItem==this.$refs.search_input?this.focusedItem=this.$refs.list.firstElementChild:(this.focusedItem=this.focusedItem.nextElementSibling,this.focusedItem||(this.focusedItem=this.$refs.list.firstElementChild)),this.focusedItem&&this.focusedItem.focus()},processArrowKeyUp:function(){if(!this.listVisible)return void this.setSelectorVisible(!0);this.focusedItem==this.$refs.search_input?this.focusedItem=this.$refs.list.lastElementChild:(this.focusedItem=this.focusedItem.previousElementSibling,this.focusedItem||(this.focusedItem=this.$refs.list.lastElementChild)),this.focusedItem&&this.focusedItem.focus()},setSelectorVisible:function(t,e){var i=this;this.listVisible=t,t?this.$nextTick(function(){i.$refs.search_input.focus(),i.focusedItem=i.$refs.search_input}):(this.listFilter="",e&&this.$refs.tags_input.focus())},validateString:function(t){return t.toLowerCase().replace(/\s+/g," ").replace(/[^\s0-9a-zA-Zа-яА-Я_]+/,"")},addTagToOut:function(t){this.setSelectorVisible(!1,!0),this.outTags.includes(t)||this.outTags.push(t)},handleClickOutside:function(t){this.setSelectorVisible(!1)}}}},292:function(t,e,i){"use strict";var a=i(14),s=i.n(a),r=i(8);e.a={name:"threads",data:function(){return{forums:"",curForum:{forumid:"",title:""},isEdit:!1}},methods:{loadForums:function(){var t=this;s.a.get(r.a.curdomain+"/api/forums/",{withCredentials:!0}).then(function(e){t.forums=e.data})},editForum:function(t){this.isEdit=!0,this.curForum=t},delForum:function(t){},canselEditForum:function(){this.isEdit=!1},saveForum:function(){var t=this;this.$socket.emit("save_forum",this.curForum,function(e){if(e&&"forumid"in e)t.isEdit=!1,t.forums[e.forumid]=e,t.flash("Модуль "+e.title+" сохранен","success",{timeout:2e3});else{var i="error"in e?e.error:"";t.flash("ВНИМАНИЕ!<br>Что-то пошло не так и модуль не сохранен<br>"+i,"error",{timeout:1e4})}})},newForum:function(){this.editForum({forumid:0,title:"Новый"})}},computed:{},components:{},created:function(){this.loadForums()}}},293:function(t,e,i){var a=i(294);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i(5)("3c6d9f82",a,!0)},294:function(t,e,i){e=t.exports=i(4)(!1),e.push([t.i,".characterEdit_root[data-v-0f90f752]{padding:.5em}input_field[data-v-0f90f752]{border:1px solid gray;padding:0 .1em}.flex_container[data-v-0f90f752]{display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;flex-wrap:wrap}.flex_element[data-v-0f90f752]{flex-grow:2}.full_width[data-v-0f90f752]{width:100%}.space_after[data-v-0f90f752]{padding-right:.5rem}.frame[data-v-0f90f752]{border:1px solid #d3d3d3;border-radius:3px}.thickLine[data-v-0f90f752]{margin:.3em 0}.v_center[data-v-0f90f752]{margin:auto}",""])},295:function(t,e,i){var a=i(296);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i(5)("01ca6fc9",a,!0)},296:function(t,e,i){e=t.exports=i(4)(!1),e.push([t.i,".characterEdit_root input[type=text]{padding:0 .1em}",""])},297:function(t,e,i){"use strict";function a(t){i(298)}var s=i(284),r=i(300),n=i(6),o=a,c=n(s.a,r.a,!1,o,"data-v-7a0b7f55",null);e.a=c.exports},298:function(t,e,i){var a=i(299);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i(5)("6338f311",a,!0)},299:function(t,e,i){e=t.exports=i(4)(!1),e.push([t.i,".tags[data-v-7a0b7f55]{position:relative;display:flex;flex-grow:2;border:1px solid #d3d3d3}.tags_input[data-v-7a0b7f55]{border:none;flex-grow:2}.tags_select_button[data-v-7a0b7f55]{cursor:pointer;border:none;border-left:1px solid #fafafa;background:#f8f8f8;flex-grow:0}.tags_select_button[data-v-7a0b7f55]:hover{background-color:#fff}.tags_list_frame[data-v-7a0b7f55]{position:absolute;overflow:auto;max-height:6rem;top:calc(100% + 2px);background:#fff;border-radius:0;right:0;z-index:100;padding:.2em;border:1px solid gray;box-shadow:3px 3px 5px 0 rgba(0,0,0,.2)}.tags_list_frame ul[data-v-7a0b7f55]{margin:.3em 0}.tags_list_frame li[data-v-7a0b7f55]{padding:0 .3em 0 .2em;cursor:pointer}.tags_list_frame li[data-v-7a0b7f55]:focus,.tags_list_frame li[data-v-7a0b7f55]:hover{background-color:#cfe7f0}.tags_select_search[data-v-7a0b7f55]{border:none;border-bottom:1px solid #d3d3d3}",""])},300:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("click-outside",{attrs:{handler:t.handleClickOutside}},[i("div",{staticClass:"tags",on:{keydown:[function(e){if(!("button"in e)&&t._k(e.keyCode,"esc",27,e.key))return null;t.setSelectorVisible(!1,!0)},function(e){if(!("button"in e)&&t._k(e.keyCode,"down",40,e.key))return null;t.processArrowKeyDown()},function(e){if(!("button"in e)&&t._k(e.keyCode,"up",38,e.key))return null;t.processArrowKeyUp()}]}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.inputText,expression:"inputText"}],ref:"tags_input",staticClass:"tags_input",attrs:{type:"text",placeholder:"Тэги через пробел"},domProps:{value:t.inputText},on:{input:function(e){e.target.composing||(t.inputText=e.target.value)}}}),t._v(" "),i("button",{staticClass:"tags_select_button",attrs:{title:"Добавить тэг из списка существующих.\nОткрывается нажатием ↓ из строки поиска"},on:{click:function(e){t.setSelectorVisible(!t.listVisible)}}},[t._v("+\n            ")]),t._v(" "),t.listVisible?i("div",{ref:"tag_list",staticClass:"tags_list_frame"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.listFilter,expression:"listFilter"}],ref:"search_input",staticClass:"tags_select_search",attrs:{type:"text",placeholder:" Поиск",tabindex:"0"},domProps:{value:t.listFilter},on:{input:function(e){e.target.composing||(t.listFilter=e.target.value)}}}),t._v(" "),i("ul",{ref:"list",attrs:{tabindex:"1"}},t._l(t.tagsFiltered,function(e,a){return i("li",{staticClass:"tags_select_li",attrs:{tabindex:a+1},on:{click:function(i){t.addTagToOut(e)},keydown:function(i){if(!("button"in i)&&t._k(i.keyCode,"enter",13,i.key))return null;t.addTagToOut(e)}}},[t._v("\n                        "+t._s(e)+"\n                    ")])}))]):t._e()])])},s=[],r={render:a,staticRenderFns:s};e.a=r},301:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"characterEdit_root"},[i("fieldset",{staticClass:"frame"},[i("legend",[t._v("Поиск")]),t._v(" "),i("div",{staticClass:"flex_container thickLine"},[i("span",{staticClass:"space_after v_center"},[t._v("Имя")]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.charFilter,expression:"charFilter"}],staticClass:"flex_element input_field v_center",attrs:{type:"text",maxlength:"64",placeholder:"Имя или его начало"},domProps:{value:t.charFilter},on:{input:function(e){e.target.composing||(t.charFilter=e.target.value)}}})]),t._v(" "),i("div",{staticClass:"flex_container thickLine"},[i("span",{staticClass:"space_after v_center"},[t._v("Тэги")]),t._v(" "),i("tags-input",{staticClass:"flex_element v_center",attrs:{fullTagList:t.allTags,maxlength:"64",placeholder:"Тэги через пробел"},model:{value:t.tagsFilter,callback:function(e){t.tagsFilter=e},expression:"tagsFilter"}})],1),t._v(" "),i("select",{directives:[{name:"model",rawName:"v-model",value:t.currentChar,expression:"currentChar"}],ref:"charSelect",staticClass:"full_width thickLine",attrs:{size:"5"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.currentChar=e.target.multiple?i:i[0]},t.selectCharacter]}},t._l(t.filteredCharacters,function(e){return i("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))]),t._v(" "),i("fieldset",{staticClass:"frame"},[i("legend",[t._v("Персонаж")]),t._v(" "),i("div",{staticClass:"flex_container thickLine"},[i("span",{staticClass:"space_after v_center"},[t._v("Имя")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.editData.name,expression:"editData.name"}],staticClass:"flex_element input_field",attrs:{type:"text",maxlength:"64",placeholder:"Мне нужно ИМЯ!"},domProps:{value:t.editData.name},on:{input:function(e){e.target.composing||t.$set(t.editData,"name",e.target.value)}}})]),t._v(" "),i("span",{staticClass:"thickLine v_center"},[t._v("Описание")]),i("br"),t._v(" "),i("div",{staticClass:"flex_container"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editData.description,expression:"editData.description"}],staticClass:"full_width thickLine",attrs:{rows:"4"},domProps:{value:t.editData.description},on:{input:function(e){e.target.composing||t.$set(t.editData,"description",e.target.value)}}})]),t._v(" "),i("div",{staticClass:"flex_container thickLine",attrs:{id:"character_tags_container"},on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"esc",27,e.key))return null;t.showTagSelector(!1)}}},[i("span",{staticClass:" space_after v_center"},[t._v("Тэги")]),t._v(" "),i("tags-input",{staticClass:"flex_element v_center",attrs:{fullTagList:t.allTags,maxlength:"64",placeholder:"Тэги через пробел"},model:{value:t.editData.tags,callback:function(e){t.$set(t.editData,"tags",e)},expression:"editData.tags"}})],1),t._v(" "),t.editData.author?i("div",{staticClass:"thickLine"},[i("span",[t._v("Автор:")]),t._v(" "),i("span",{staticClass:"display_frame "},[t._v(t._s(t.editData.author_name))])]):t._e(),t._v(" "),i("div",{staticClass:"flex_container thickLine"},[i("button",{attrs:{title:"Сбросить редактирование"},on:{click:t.resetEditData}},[t._v("Новый")]),t._v(" "),i("div",{staticClass:"flex_element"}),t._v(" "),i("button",{attrs:{id:"delete_button",title:"Отправить персонажа в варп",disabled:!t.currentChar},on:{click:t.deleteCharacter}},[t._v("Удалить\n            ")]),t._v(" "),i("button",{attrs:{id:"save_button",title:"Сохранить"},on:{click:t.saveChanges}},[t._v("Сохранить\n            ")])])])])},s=[],r={render:a,staticRenderFns:s};e.a=r},321:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"threads_root"},[i("div",{staticClass:"threads_conteiner"},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}]},[t._v("\n            "+t._s(t.curForum.forumid)+"\n            "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.curForum.title,expression:"curForum.title"}],domProps:{value:t.curForum.title},on:{input:function(e){e.target.composing||t.$set(t.curForum,"title",e.target.value)}}}),t._v(" "),i("button",{on:{click:t.saveForum}},[t._v("Сохранить")]),t._v(" "),i("button",{on:{click:t.canselEditForum}},[t._v("Отмена")])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit,expression:"!isEdit"}],staticClass:"threads_forums"},[t._l(t.forums,function(e){return[i("div",{class:{threads_forum:!0,threads_forum_root:e.isRoot}},[i("div",{staticClass:"threads_forum_title"},[t._v(t._s(e.title))]),t._v(" "),i("div",{staticClass:"threads_forum_buttons"},[e.isMain?t._e():i("div",[i("button",{on:{click:function(i){t.editForum(e)}}},[t._v("Изменить")])]),t._v(" "),e.isMain?i("div",[i("button",{on:{click:function(e){t.newForum()}}},[t._v("Новый модуль")])]):t._e()]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"forum.show"}],staticClass:"threads_threads"},t._l(e.threads,function(e){return i("div",{staticClass:"threads_thread"},[t._v(t._s(e.title))])}))])]})],2)])])},s=[],r={render:a,staticRenderFns:s};e.a=r}});
//# sourceMappingURL=game.build.js.map?f45d59f1892339f38772