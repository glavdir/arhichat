webpackJsonp([0],{184:function(t,e,a){"use strict";function i(t){a(200),a(202)}Object.defineProperty(e,"__esModule",{value:!0});var s=a(190),r=a(209),n=a(5),o=i,c=n(s.a,r.a,!1,o,"data-v-521fbe4f",null);e.default=c.exports},189:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(199),s=a(229),r=a(5),n=r(i.a,s.a,!1,null,null,null);e.default=n.exports},190:function(t,e,a){"use strict";function i(){return{id:null,name:"",description:"",author:null,author_name:"",tags:[]}}var s=(a(8),a(7),a(23)),r=(a.n(s),a(204));e.a={components:{"tag-select":r.a},data:function(){return{currentChar:"",charList:[],charFilter:"",tagsFilter:null,tagPattern:"[\\s0-9a-zA-Zа-яА-Я_]+",editData:i(),allTags:[],allTagsDict:{}}},created:function(){this.$socket.emit("find_characters"),this.$socket.emit("get_tags")},computed:{filteredCharacters:function(){var t=this.charFilter.trim(),e=t.length>0,a=this.tagsFilter;if(!e&&!a)return this.charList;var i=[];for(var s in this.charList){var r=this.charList[s];if(e&&r.name.toLowerCase().includes(t.toLowerCase()))i.includes(r)||i.push(r);else if(a){var n=!0;for(var o in this.tagsFilter)if(!r.tags.includes(this.tagsFilter[o])){n=!1;break}n&&!i.includes(r)&&i.push(r)}}return i}},methods:{remove_empty_elements:function(t){var e=[];for(var a in t)""!=t[a]&&e.push(t[a]);return e},find_characters:function(){var t={name:this.charFilter,tags:this.remove_empty_elements(this.tagsFilter)};this.$socket.emit("find_characters",t)},setCharacterList:function(t){var e=this.currentChar;if(this.charList=t,e)for(var a in this.charList)if(this.charList[a].id==e)return void this.selectCharacter()},selectCharacter:function(){if(this.currentChar&&0!=this.currentChar.length){var t=this;this.$socket.emit("get_character_info",{id:this.currentChar},function(e){t.setCharacterData(JSON.parse(e))})}else this.editData=i()},setCharacterData:function(t){this.editData=t},resetEditData:function(){this.editData=i(),this.currentChar=null},saveChanges:function(t){var e=this;if(this.currentChar){var a=this.$refs.charSelect.options[this.$refs.charSelect.selectedIndex].text;if(!window.confirm('Вы точно хотите изменить персонажа "'+a+'"?'))return}if(0==this.editData.name.length||0==this.editData.description.length)return void this.flash('Заполните поля "Имя" и "Описание" для сохранения персонажа',"error",{timeout:2e3});this.editData.tags=this.remove_empty_elements(this.editData.tags);var i=this.editData.name;this.$socket.emit("save_character",{Character:this.editData},function(t){t?(e.flash('Персонаж "'+i+'" успешно сохранен',"success",{timeout:2e3}),e.setCharacterData(JSON.parse(t))):e.flash('Упс! Не получилось создать персонажа "'+i+'"',"error",{timeout:2e3})})},deleteCharacter:function(){var t=this;if(!this.currentChar)return void this.flash("Такого персонажа не существует. Персонаж не выбран или кто-то его уже удалил пока вы тупили. Перезагрузите страницу","error",{timeout:2e3});var e=this.$refs.charSelect.options[this.$refs.charSelect.selectedIndex].text;console.log(e),window.confirm('Вы точно хотите удалить персонажа "'+e+'"?')&&window.confirm("Если потом передумаете придётся восстанавливать вручную. Точно удалять?")&&this.$socket.emit("delete_character",{Character:this.currentChar},function(a){console.log(a),a?(alert('Персонаж "'+e+'" удалён'),t.resetEditData(),t.find_characters()):t.flash('Упс! Что-то пошло не так. Персонаж "'+e+'" не был удалён',"error",{timeout:2e3})})}},sockets:{character_list:function(t){this.setCharacterList(JSON.parse(t))},character_tags:function(t){this.allTags=JSON.parse(t);for(var e in this.allTags)this.allTagsDict[this.allTags[e]]=this.allTags[e]}}}},191:function(t,e,a){"use strict";e.a={props:{elementId:String,inputClass:{type:String,default:"tags-input-default-class"},existingTags:{type:Object,default:function(){return{}}},value:{type:[Array,String],default:function(){return[]}},typeahead:{type:Boolean,default:!1},placeholder:{type:String,default:"Add a tag"},limit:{type:Number,default:0},onlyExistingTags:{type:Boolean,default:!1},deleteOnBackspace:{type:Boolean,default:!0}},data:function(){return{badgeId:0,tagBadges:[],tags:[],input:"",oldInput:"",hiddenInput:"",searchResults:[],searchSelection:0}},created:function(){this.tagsFromValue()},watch:{tags:function(){this.hiddenInput=this.tags.join(","),this.$emit("input",this.tags)},value:function(){this.tagsFromValue()}},methods:{tagFromInput:function(t){if(this.searchResults.length&&this.searchSelection>=0)this.tagFromSearch(this.searchResults[this.searchSelection]),this.input="";else{var e=this.input.trim();if(!this.onlyExistingTags&&e.length){this.input="";var a=this.makeSlug(e),i=this.existingTags[a];a=i?a:e,e=i||e,this.addTag(a,e)}}},tagFromSearch:function(t){this.searchResults=[],this.input="",this.oldInput="",this.addTag(t.slug,t.text)},makeSlug:function(t){return t.toLowerCase().replace(/\s/g,"-")},addTag:function(t,e){var a=this;if(this.limit>0&&this.tags.length>=this.limit)return!1;var i=this.makeSlug(t);this.tags.find(function(t){return i==a.makeSlug(t)})||(this.tagBadges.push(e.replace(/\s/g,"&nbsp;")),this.tags.push(t))},removeLastTag:function(t){!t.target.value.length&&this.deleteOnBackspace&&this.removeTag(this.tags.length-1)},removeTag:function(t){this.tags.splice(t,1),this.tagBadges.splice(t,1)},searchTag:function(t){if(!0===this.typeahead&&this.oldInput!=this.input){this.searchResults=[],this.searchSelection=0;var e=this.input.trim();if(e.length){for(var a in this.existingTags){this.existingTags[a].toLowerCase().search(e.toLowerCase())>-1&&this.searchResults.push({slug:a,text:this.existingTags[a]})}this.searchResults.sort(function(t,e){return t.text<e.text?-1:t.text>e.text?1:0})}this.oldInput=this.input}},nextSearchResult:function(){this.searchSelection+1<=this.searchResults.length-1&&this.searchSelection++},prevSearchResult:function(){this.searchSelection>0&&this.searchSelection--},ignoreSearchResults:function(){this.searchResults=[],this.searchSelection=0},clearTags:function(){this.tags.splice(0,this.tags.length),this.tagBadges.splice(0,this.tagBadges.length)},tagsFromValue:function(){if(this.value&&this.value.length){var t=Array.isArray(this.value)?this.value:this.value.split(",");if(this.tags==t)return;this.clearTags();var e=!0,a=!1,i=void 0;try{for(var s,r=t[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var n=s.value,o=this.existingTags[n],c=o||n;this.addTag(n,c)}}catch(t){a=!0,i=t}finally{try{!e&&r.return&&r.return()}finally{if(a)throw i}}}else{if(0==this.tags.length)return;this.clearTags()}}}}},199:function(t,e,a){"use strict";var i=a(12),s=a.n(i),r=a(8);e.a={name:"threads",data:function(){return{forums:[],curForum:{forumid:"",title:""},isEdit:!1}},methods:{loadForums:function(){var t=this;s.a.get(r.a.curdomain+"/api/forums/",{withCredentials:!0}).then(function(e){t.forums=e.data,console.log(e.data)})},editForum:function(t){this.isEdit=!0,this.curForum=t},delForum:function(t){},newThread:function(t){},canselEditForum:function(){this.isEdit=!1},saveForum:function(){var t=this;this.$socket.emit("save_forum",this.curForum,function(e){if(e&&"forumid"in e)t.isEdit=!1,t.curForum=e,t.flash("Модуль "+e.title+" сохранен","success",{timeout:2e3});else{var a="error"in e?e.error:"";t.flash("ВНИМАНИЕ!<br>Что-то пошло не так и модуль не сохранен<br>"+a,"error",{timeout:1e4})}})},newForum:function(){this.editForum({forumid:0,title:"Новый"})}},computed:{orderedForums:function(){return this.forums.sort(function(t,e){if(t.orrder>e.order)return 1})}},components:{},created:function(){this.loadForums()}}},200:function(t,e,a){var i=a(201);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a(3)("0e7c1ceb",i,!0)},201:function(t,e,a){e=t.exports=a(2)(!1),e.push([t.i,".characterEdit_root[data-v-521fbe4f]{padding:.5em}.flex_container[data-v-521fbe4f]{display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;flex-wrap:wrap}.flex_element[data-v-521fbe4f]{flex-grow:1}.full_width[data-v-521fbe4f]{width:100%}.space_after[data-v-521fbe4f]{padding-right:.5rem}.frame[data-v-521fbe4f]{border:1px solid #d3d3d3;border-radius:3px}.thickLine[data-v-521fbe4f]{margin:.3em 0}.v_center[data-v-521fbe4f]{margin:auto}",""])},202:function(t,e,a){var i=a(203);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a(3)("6b75189d",i,!0)},203:function(t,e,a){e=t.exports=a(2)(!1),e.push([t.i,".characterEdit_root .form-control{padding:.1rem .2rem;width:inherit}.characterEdit_root .badge-light{font-size:100%}.characterEdit_root .input_field{border:1px solid #ced4da;border-radius:.25rem;padding:.1rem .2rem}.characterEdit_root .tags-input span{margin-bottom:0}.characterEdit_root .tags-input-default-class{padding:.1rem .2rem;flex-grow:1}",""])},204:function(t,e,a){"use strict";var i=a(205);window.VoerroTagsInput=i.a,e.a=i.a},205:function(t,e,a){"use strict";function i(t){a(206)}var s=a(191),r=a(208),n=a(5),o=i,c=n(s.a,r.a,!1,o,null,null);e.a=c.exports},206:function(t,e,a){var i=a(207);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a(3)("1d414800",i,!0)},207:function(t,e,a){e=t.exports=a(2)(!1),e.push([t.i,".tags-input{display:flex;flex-wrap:wrap;align-items:center}.tags-input input{flex:1;background:transparent;border:none}.tags-input span{margin-right:.3rem;margin-bottom:.2rem}.typeahead>span{cursor:pointer;margin-right:.3rem}",""])},208:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{class:t.inputClass+" tags-input"},[t._l(t.tagBadges,function(e,i){return a("span",{key:i,staticClass:"badge badge-pill badge-light"},[a("span",{domProps:{innerHTML:t._s(e)}}),t._v(" "),a("i",{staticClass:"tags-input-remove",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.removeTag(i)}}})])}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],attrs:{type:"text",placeholder:t.placeholder},domProps:{value:t.input},on:{keyup:[function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.preventDefault(),t.tagFromInput(e)},function(e){if(!("button"in e)&&t._k(e.keyCode,"esc",27,e.key))return null;t.ignoreSearchResults(e)},t.searchTag],keydown:[function(e){if(!("button"in e)&&8!==e.keyCode)return null;t.removeLastTag(e)},function(e){if(!("button"in e)&&t._k(e.keyCode,"down",40,e.key))return null;t.nextSearchResult(e)},function(e){if(!("button"in e)&&t._k(e.keyCode,"up",38,e.key))return null;t.prevSearchResult(e)}],value:t.tags,input:function(e){e.target.composing||(t.input=e.target.value)}}}),t._v(" "),t.elementId?a("input",{directives:[{name:"model",rawName:"v-model",value:t.hiddenInput,expression:"hiddenInput"}],attrs:{type:"hidden",name:t.elementId,id:t.elementId},domProps:{value:t.hiddenInput},on:{input:function(e){e.target.composing||(t.hiddenInput=e.target.value)}}}):t._e()],2),t._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:t.searchResults.length,expression:"searchResults.length"}],staticClass:"typeahead"},t._l(t.searchResults,function(e,i){return a("span",{key:i,staticClass:"badge",class:{"badge-primary":i==t.searchSelection,"badge-dark":i!=t.searchSelection},domProps:{textContent:t._s(e.text)},on:{click:function(a){t.tagFromSearch(e)}}})}))])},s=[],r={render:i,staticRenderFns:s};e.a=r},209:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"characterEdit_root"},[a("fieldset",{staticClass:"frame"},[a("legend",[t._v("Поиск")]),t._v(" "),a("div",{staticClass:"flex_container thickLine"},[a("span",{staticClass:"space_after v_center"},[t._v("Имя")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.charFilter,expression:"charFilter"}],staticClass:"flex_element input_field",attrs:{type:"text",maxlength:"64",placeholder:"Имя или его часть"},domProps:{value:t.charFilter},on:{input:function(e){e.target.composing||(t.charFilter=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"flex_container thickLine"},[a("span",{staticClass:"space_after v_center"},[t._v("Тэги")]),t._v(" "),a("tag-select",{staticClass:"flex_element",attrs:{"existing-tags":t.allTagsDict,typeahead:!0,placeholder:"Тэги"},model:{value:t.tagsFilter,callback:function(e){t.tagsFilter=e},expression:"tagsFilter"}})],1),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:t.currentChar,expression:"currentChar"}],ref:"charSelect",staticClass:"full_width thickLine",attrs:{size:"5"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.currentChar=e.target.multiple?a:a[0]},t.selectCharacter]}},t._l(t.filteredCharacters,function(e){return a("option",{domProps:{value:e.id}},[t._v(t._s(e.name))])}))]),t._v(" "),a("fieldset",{staticClass:"frame"},[a("legend",[t._v("Персонаж")]),t._v(" "),a("div",{staticClass:"flex_container thickLine"},[a("span",{staticClass:"space_after v_center"},[t._v("Имя")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.editData.name,expression:"editData.name"}],staticClass:"flex_element input_field",attrs:{type:"text",maxlength:"64",placeholder:"Мне нужно ИМЯ!"},domProps:{value:t.editData.name},on:{input:function(e){e.target.composing||t.$set(t.editData,"name",e.target.value)}}})]),t._v(" "),a("span",{staticClass:"thickLine v_center"},[t._v("Описание")]),a("br"),t._v(" "),a("div",{staticClass:"flex_container"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editData.description,expression:"editData.description"}],staticClass:"full_width thickLine",attrs:{rows:"4"},domProps:{value:t.editData.description},on:{input:function(e){e.target.composing||t.$set(t.editData,"description",e.target.value)}}})]),t._v(" "),a("div",{staticClass:"flex_container thickLine",attrs:{id:"character_tags_container"},on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"esc",27,e.key))return null;t.showTagSelector(!1)}}},[a("span",{staticClass:" space_after v_center"},[t._v("Тэги")]),t._v(" "),a("tag-select",{ref:"character_tags",staticClass:"flex_element",attrs:{"existing-tags":t.allTagsDict,typeahead:!0,placeholder:"Тэги"},model:{value:t.editData.tags,callback:function(e){t.$set(t.editData,"tags",e)},expression:"editData.tags"}})],1),t._v(" "),t.editData.author?a("div",{staticClass:"thickLine"},[a("span",[t._v("Автор:")]),t._v(" "),a("span",{staticClass:"display_frame "},[t._v(t._s(t.editData.author_name))])]):t._e(),t._v(" "),a("div",{staticClass:"flex_container thickLine"},[a("button",{attrs:{title:"Сбросить редактирование"},on:{click:t.resetEditData}},[t._v("Новый")]),t._v(" "),a("div",{staticClass:"flex_element"}),t._v(" "),a("button",{attrs:{id:"delete_button",title:"Отправить персонажа в варп",disabled:!t.currentChar},on:{click:t.deleteCharacter}},[t._v("Удалить\n            ")]),t._v(" "),a("button",{attrs:{id:"save_button",title:"Сохранить"},on:{click:t.saveChanges}},[t._v("Сохранить\n            ")])])])])},s=[],r={render:i,staticRenderFns:s};e.a=r},229:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"threads_root"},[a("div",{staticClass:"threads_conteiner"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}]},[t._v("\n            "+t._s(t.curForum.forumid)+"\n            "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.curForum.title,expression:"curForum.title"}],domProps:{value:t.curForum.title},on:{input:function(e){e.target.composing||t.$set(t.curForum,"title",e.target.value)}}}),t._v(" "),a("button",{on:{click:t.saveForum}},[t._v("Сохранить")]),t._v(" "),a("button",{on:{click:t.canselEditForum}},[t._v("Отмена")])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit,expression:"!isEdit"}],staticClass:"threads_forums"},[t._l(t.orderedForums,function(e){return a("div",{key:e.order,class:{threads_forum:!0,threads_forum_root:e.isRoot}},[a("div",{staticClass:"threads_forum_title"},[t._v(t._s(e.title))]),t._v(" "),a("div",{staticClass:"threads_forum_buttons"},[e.isMain?t._e():a("div",[a("button",{on:{click:function(a){t.editForum(e)}}},[t._v("Изменить")]),t._v(" "),a("button",{on:{click:function(a){t.newThread(e)}}},[t._v("Новый канал")])]),t._v(" "),e.isMain?a("div",[a("button",{on:{click:function(e){t.newForum()}}},[t._v("Новый модуль")])]):t._e()])])})],2)])])},s=[],r={render:i,staticRenderFns:s};e.a=r}});
//# sourceMappingURL=game.build.js.map?0160a2bf80fd2c4cfa14